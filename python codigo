import json
import tkinter as tk
from tkinter import ttk
import webbrowser

# Function to fetch NGO data
def get_ongs_data():
    # Load data from JSON file
    with open("ongs.json", encoding='utf-8') as f:
        data = json.load(f)
    
    return data["ongs"]

# Function to refresh NGO data and update UI
def refresh_ongs():
    global ongs
    ongs = get_ongs_data()
    update_ui()

# Function to update UI with new NGO data
def update_ui():
    global displayed_ongs_index
    # Destroy existing widgets
    for child in frame.winfo_children():
        child.destroy()

    # Show information for two NGOs
    for idx, ong_index in enumerate(displayed_ongs_index, start=1):
        ong = ongs[ong_index]
        # Create label for NGO name and reliability
        ttk.Label(frame, text=f"{ong['nome']} Â  {ong['confiabilidade']}", font=("Helvetica", 10, "bold")).grid(row=idx, column=1, sticky="w", padx=10, pady=5)

        # Create label for NGO description
        ttk.Label(frame, text=ong["descricao"], wraplength=300, font=("Helvetica", 9)).grid(row=idx, column=2, padx=10, pady=5)

        # Create button to open NGO website
        open_button = ttk.Button(frame, text="Visitar", command=lambda url=ong["url"]: webbrowser.open_new_tab(url))
        open_button.grid(row=idx, column=3, padx=10, pady=5)

# Function to toggle displayed NGOs
def toggle_ongs():
    global displayed_ongs_index
    displayed_ongs_index = [(displayed_ongs_index[0] + 2) % len(ongs), (displayed_ongs_index[1] + 2) % len(ongs)]
    update_ui()

# Create the main window
root = tk.Tk()
root.title("ONGs Para Ajudar No RS")

# Create a frame to hold the NGO links
frame = ttk.Frame(root, padding="10")
frame.grid(row=0, column=0, sticky="nsew")

# Initialize NGO data
ongs = get_ongs_data()

# Initially display first two NGOs
displayed_ongs_index = [0, 1]
update_ui()

# Create a button to toggle displayed NGOs
toggle_button = ttk.Button(root, text="Mostrar outras ONGs", command=toggle_ongs)
toggle_button.grid(row=1, column=0, sticky="w", padx=10, pady=5)

# Run the main event loop
root.mainloop()
